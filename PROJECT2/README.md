# PROJECT2
## 实验要求
编程实现图片水印嵌入和提取（可依托开源项目二次开发），并进行鲁棒性测试，包括不限于翻转、平移、截取、调对比度等
## 实验内容
采用离散小波变换和奇异值分解相结合的技术，将水印信息嵌入到宿主图像的低频分量中。使用Python及OpenCV、NumPy、PyWavelets等开源库完成了算法的实现。为了验证算法的有效性和鲁棒性，对嵌入水印的图像进行了一系列攻击测试，包括JPEG压缩、高斯噪声、翻转、裁剪、旋转和对比度增强。最终通过计算原始水印与提取水印之间的归一化相关系数NC来定量评估算法性能。

## 实验过程
- 加载宿主图像和水印图像，并将其转换为灰度格式
  - 使用 `cv2.imread` 以 BGR 格式加载图像，再用 `cv2.cvtColor(..., cv2.COLOR_BGR2GRAY)` 获取灰度图，只处理亮度信息，保留色彩分量。
- 对灰度图像进行二维离散小波变换（DWT），分解为低频 LL 和高频 LH、HL、HH 子带
  - 调用 `pywt.dwt2` ，选用 'haar' 小波，对图像进行分解，以便嵌入水印到低频子带中。
- 对 LL 子带矩阵进行奇异值分解（SVD），得到 U、Σ、Vᵀ
  - 使用 `np.linalg.svd` 计算分解，Σ 包含图像特征奇异值，后续用于融合水印信息。
- 对水印图像进行 DWT 与 SVD 分解
  - 先对水印图像做 DWT，再对水印 LL 子带执行 SVD，获取 Uw、Σw、Vwᵀ，提取水印特征。
- 按比例因子 α 将 Σw 嵌入到宿主图像 LL 子带的 Σ 中，得到新的奇异值矩阵 Σ'
  - 通过 `Σ + α * Σw_padded` 将水印奇异值融合到宿主图像低频奇异值中，使水印与载体紧密结合。
- 使用 U、Σ'、Vᵀ 重构嵌入水印后的 LL 子带并进行逆 DWT，生成水印图像
  - 调用 `pywt.idwt2` 将修改后的低频子带与原始高频子带一起逆变换，还原为带水印图像。
- 对嵌入水印的图像执行多种攻击测试
  - 包括 JPEG 压缩、高斯噪声、水平/垂直翻转、中心裁剪、5° 旋转、对比度增强等，评估算法鲁棒性。
- 对每种攻击图像重复 DWT+SVD 流程，提取水印奇异值并重构水印图像
  - 使用水印提取函数 `_extract_dwt_svd` 从攻击图像低频子带差异中恢复水印信息。
- 计算提取水印与原始水印之间的归一化相关系数（NC）
  - 调用 `calculate_nc` 函数，比较提取水印和原始水印像素，数值越接近 1 表示恢复效果越好。

## 实验结果
### 添加水印后的图片
![alt text](attacked_images/attacked_no_attack.png)
### 提取出的水印
![实验结果](.\attacked_images\extracted_no_attack.png)
### NC值
![alt text](<pic/屏幕截图 2025-07-08 150058.png>)
